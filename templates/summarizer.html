<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summarizer Dashboard - MultiLanguage AI Text Summarizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js" type="module"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-bg-dark {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
        }
        .tab-active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .tab-inactive {
            background: white;
            color: #6b7280;
        }
        .tab-inactive-dark {
            background: #374151;
            color: #d1d5db;
        }
        .input-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .input-card-dark {
            background: #374151;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(79, 172, 254, 0.4);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        /* Dark mode styles */
        .dark {
            color-scheme: dark;
        }
        
        /* Professional dark theme colors */
        .dark .bg-white {
            background-color: #1e1e2e;
            border: 1px solid #2d2d44;
        }
        .dark .bg-gray-50 {
            background-color: #2a2a3e;
        }
        .dark .bg-gray-100 {
            background-color: #3a3a4e;
        }
        .dark .bg-gray-200 {
            background-color: #4a4a5e;
        }
        .dark .bg-gray-800 {
            background-color: #1a1a2e;
        }
        
        /* Text colors for dark theme */
        .dark .text-gray-900 {
            color: #ffffff;
        }
        .dark .text-gray-800 {
            color: #f8fafc;
        }
        .dark .text-gray-700 {
            color: #e2e8f0;
        }
        .dark .text-gray-600 {
            color: #cbd5e1;
        }
        .dark .text-gray-500 {
            color: #94a3b8;
        }
        .dark .text-gray-400 {
            color: #64748b;
        }
        
        /* Border colors */
        .dark .border-gray-200 {
            border-color: #4a4a5e;
        }
        .dark .border-gray-300 {
            border-color: #5a5a6e;
        }
        
        /* Card styling */
        .dark .input-card {
            background-color: #1e1e2e;
            border: 1px solid #2d2d44;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }
        .dark .input-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 8px 25px -5px rgba(59, 130, 246, 0.2);
        }
        
        /* Tab styling */
        .dark .tab-inactive {
            background-color: #2a2a3e;
            color: #cbd5e1;
            border: 1px solid #4a4a5e;
        }
        .dark .tab-inactive:hover {
            background-color: #3a3a4e;
            color: #ffffff;
        }
        
        /* Button styling */
        .dark .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: #ffffff;
            border: 1px solid #2563eb;
        }
        .dark .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 8px 25px -5px rgba(59, 130, 246, 0.4);
        }
        
        .dark .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: #ffffff;
            border: 1px solid #6b7280;
        }
        .dark .btn-secondary:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
        }
        
        /* Special colors */
        .dark .bg-blue-50 {
            background-color: #1e3a8a;
        }
        .dark .border-blue-200 {
            border-color: #3b82f6;
        }
        .dark .text-blue-800 {
            color: #dbeafe;
        }
        .dark .bg-red-50 {
            background-color: #7f1d1d;
        }
        .dark .border-red-200 {
            border-color: #ef4444;
        }
        .dark .text-red-800 {
            color: #fecaca;
        }
        
        /* Enhanced shadows for dark theme */
        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }
        .dark .shadow-xl {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }
        
        /* Text area styling */
        .dark textarea {
            background-color: #2a2a3e;
            border-color: #4a4a5e;
            color: #e2e8f0;
        }
        .dark textarea:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .dark textarea::placeholder {
            color: #64748b;
        }
        
        /* Input styling */
        .dark input {
            background-color: #2a2a3e;
            border-color: #4a4a5e;
            color: #e2e8f0;
        }
        .dark input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .dark input::placeholder {
            color: #64748b;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen" id="body">
    <!-- Header -->
    <div class="bg-white dark:bg-gray-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-brain text-3xl text-purple-600 mr-3"></i>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">MultiLanguage AI Text Summarizer</h1>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Language: <span class="font-semibold text-purple-600 dark:text-purple-400">{{ language.title() }}</span></p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="toggleTheme()" id="theme-toggle" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 transition-colors" title="Toggle theme">
                        <!-- Sun icon for dark mode -->
                        <svg id="sun-icon" class="w-5 h-5 text-gray-600 dark:text-yellow-400 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <!-- Moon icon for light mode -->
                        <svg id="moon-icon" class="w-5 h-5 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                    <a href="/" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-200 rounded-lg transition-colors">
                        <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                        </svg>
                        Home
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Input Type Tabs -->
        <div class="mb-8">
            <div class="flex flex-wrap gap-2 bg-white rounded-xl p-2 shadow-lg">
                <button onclick="switchTab('text')" id="tab-text" class="tab-active px-6 py-3 rounded-lg font-medium transition-all">
                    <i class="fas fa-keyboard mr-2"></i>Text
                </button>
                <button onclick="switchTab('url')" id="tab-url" class="tab-inactive px-6 py-3 rounded-lg font-medium transition-all">
                    <i class="fas fa-link mr-2"></i>URL
                </button>
                <button onclick="switchTab('pdf')" id="tab-pdf" class="tab-inactive px-6 py-3 rounded-lg font-medium transition-all">
                    <i class="fas fa-file-pdf mr-2"></i>PDF
                </button>
                <button onclick="switchTab('youtube')" id="tab-youtube" class="tab-inactive px-6 py-3 rounded-lg font-medium transition-all">
                    <i class="fab fa-youtube mr-2"></i>YouTube
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Input Section -->
            <div class="lg:col-span-2">
                <div class="input-card dark:input-card-dark p-8">
                    <!-- Text Input Tab -->
                    <div id="content-text" class="tab-content">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">
                            <i class="fas fa-keyboard text-blue-600 dark:text-blue-400 mr-2"></i>
                            Manual Text Input
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Enter your text (Maximum 1,200 words)
                                </label>
                                <textarea 
                                    id="text-input" 
                                    rows="12" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                    placeholder="Type or paste your text here..."
                                ></textarea>
                                <div class="flex justify-between items-center mt-2">
                                    <span id="word-count" class="text-sm text-gray-500">Words: 0/1,200</span>
                                    <span id="char-count" class="text-sm text-gray-500">Characters: 0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- URL Input Tab -->
                    <div id="content-url" class="tab-content hidden">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">
                            <i class="fas fa-link text-green-600 dark:text-green-400 mr-2"></i>
                            URL Article Extraction
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Paste the article URL
                                </label>
                                <input 
                                    type="url" 
                                    id="url-input" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                    placeholder="https://example.com/article"
                                />
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-start">
                                    <i class="fas fa-info-circle text-blue-600 mt-1 mr-3"></i>
                                    <div class="text-sm text-blue-800">
                                        <p class="font-medium mb-1">Supported URLs:</p>
                                        <ul class="list-disc list-inside space-y-1">
                                            <li>News articles and blog posts</li>
                                            <li>Wikipedia pages</li>
                                            <li>Most text-based web content</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PDF Input Tab -->
                    <div id="content-pdf" class="tab-content hidden">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">
                            <i class="fas fa-file-pdf text-red-600 dark:text-red-400 mr-2"></i>
                            PDF Document Upload
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Upload PDF file (Maximum 15 pages)
                                </label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors">
                                    <input type="file" id="pdf-input" accept=".pdf" class="hidden" />
                                    <label for="pdf-input" class="cursor-pointer">
                                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                                        <p class="text-lg font-medium text-gray-700 mb-2">Click to upload PDF</p>
                                        <p class="text-sm text-gray-500">or drag and drop your file here</p>
                                    </label>
                                </div>
                                <div id="pdf-info" class="mt-4 hidden">
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium text-gray-800" id="pdf-name"></p>
                                                <p class="text-sm text-gray-600" id="pdf-size"></p>
                                            </div>
                                            <button onclick="clearPDF()" class="text-red-600 hover:text-red-800">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- YouTube Input Tab -->
                    <div id="content-youtube" class="tab-content hidden">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">
                            <i class="fab fa-youtube text-red-600 dark:text-red-400 mr-2"></i>
                            YouTube Video Processing
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Paste YouTube video URL
                                </label>
                                <input 
                                    type="url" 
                                    id="youtube-input" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                                    placeholder="https://www.youtube.com/watch?v=..."
                                />
                            </div>
                            <div class="bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-4">
                                <div class="flex items-start">
                                    <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 mt-1 mr-3"></i>
                                    <div class="text-sm text-blue-800 dark:text-blue-200">
                                        <p class="font-medium mb-1">How to use YouTube processing:</p>
                                        <ul class="list-disc list-inside space-y-1">
                                            <li>Only videos with captions/transcripts can be processed</li>
                                            <li>Try popular videos or educational content (more likely to have captions)</li>
                                            <li>If a video doesn't work, try the Text or URL input options instead</li>
                                            <li>Make sure the video is public and not age-restricted</li>
                                            <li><strong>Tip:</strong> Look for videos with the "CC" (closed captions) icon</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4 mt-4">
                                <div class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-yellow-600 dark:text-yellow-400 mt-1 mr-3"></i>
                                    <div class="text-sm text-yellow-800 dark:text-yellow-200">
                                        <p class="font-medium mb-1">If you get an error:</p>
                                        <p>Don't worry! You can still summarize content by copying the video's description or using the Text input option instead.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Length Selection -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Summary Length</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="summary-length" value="short" class="mr-3" checked>
                                <div>
                                    <div class="font-medium text-gray-800">Short</div>
                                    <div class="text-sm text-gray-500">~50 words</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="summary-length" value="medium" class="mr-3">
                                <div>
                                    <div class="font-medium text-gray-800">Medium</div>
                                    <div class="text-sm text-gray-500">~100 words</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="summary-length" value="long" class="mr-3">
                                <div>
                                    <div class="font-medium text-gray-800">Long</div>
                                    <div class="text-sm text-gray-500">~200 words</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="summary-length" value="auto" class="mr-3">
                                <div>
                                    <div class="font-medium text-gray-800">Auto</div>
                                    <div class="text-sm text-gray-500">AI decides</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="mt-8">
                        <button 
                            onclick="processInput()" 
                            id="submit-btn"
                            class="w-full btn-primary text-white px-8 py-4 rounded-lg font-semibold text-lg"
                        >
                            <i class="fas fa-magic mr-2"></i>
                            Generate Summary
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Language Info -->
                <div class="input-card dark:input-card-dark p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-language text-purple-600 dark:text-purple-400 mr-2"></i>
                        Language Settings
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Current Language:</span>
                            <span class="font-semibold text-purple-600">{{ language.title() }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Model Status:</span>
                            <span class="text-green-600 font-semibold">Ready</span>
                        </div>
                        <a href="/" class="block text-center text-blue-600 hover:text-blue-800 text-sm">
                            <i class="fas fa-edit mr-1"></i>Change Language
                        </a>
                    </div>
                </div>

                <!-- Processing Stats -->
                <div class="input-card dark:input-card-dark p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-chart-bar text-blue-600 dark:text-blue-400 mr-2"></i>
                        Processing Stats
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Documents Processed:</span>
                            <span class="font-semibold" id="doc-count">0</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Total Words:</span>
                            <span class="font-semibold" id="word-count-total">0</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-gray-600">Avg. Processing Time:</span>
                            <span class="font-semibold" id="avg-time">0s</span>
                        </div>
                    </div>
                </div>

                <!-- Quick Tips -->
                <div class="input-card dark:input-card-dark p-6">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">
                        <i class="fas fa-lightbulb text-yellow-600 dark:text-yellow-400 mr-2"></i>
                        Quick Tips
                    </h3>
                    <div class="space-y-3 text-sm text-gray-600">
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                            <span>For best results, use clear, well-structured text</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                            <span>PDFs work best with text-based content</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                            <span>YouTube videos need captions/transcripts</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="text-center">
                <div class="loading-spinner rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Processing Your Request</h3>
                <p id="loading-text" class="text-gray-600">Please wait while we process your content...</p>
                <div class="mt-4 bg-gray-200 rounded-full h-2">
                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'text';
        let processingStats = {
            documents: 0,
            words: 0,
            totalTime: 0
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            updateWordCount();
            document.getElementById('text-input').addEventListener('input', updateWordCount);
            document.getElementById('pdf-input').addEventListener('change', handlePDFUpload);
            
            // Start theme monitoring with less aggressive frequency
            setInterval(enforceTheme, 5000);
            
            // Double-check theme after a short delay
            setTimeout(() => {
                enforceTheme();
            }, 200);
        });

        function switchTab(tab) {
            console.log(`Switching to ${tab} tab, current theme: ${localStorage.getItem('theme')}`);
            
            // Preserve current theme state before switching
            const currentTheme = localStorage.getItem('theme');
            const isCurrentlyDark = document.body.classList.contains('dark');
            const language = '{{ language }}';
            
            console.log(`Theme state before ${tab} switch - Language: ${language}, Theme: ${currentTheme}, Dark: ${isCurrentlyDark}`);
            
            // Update tab buttons
            document.querySelectorAll('[id^="tab-"]').forEach(btn => {
                btn.className = btn.className.replace('tab-active', 'tab-inactive');
            });
            document.getElementById(`tab-${tab}`).className = document.getElementById(`tab-${tab}`).className.replace('tab-inactive', 'tab-active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`content-${tab}`).classList.remove('hidden');

            currentTab = tab;
            
            // Check theme consistency after tab switch (less aggressive)
            setTimeout(() => {
                const savedTheme = localStorage.getItem('theme');
                const isDark = document.body.classList.contains('dark');
                
                // Only apply theme if there's a mismatch
                if ((savedTheme === 'dark' && !isDark) || (savedTheme === 'light' && isDark)) {
                    console.log(`Theme mismatch after ${tab} tab switch - Language: ${language}, Saved: ${savedTheme}, Current: ${isDark ? 'dark' : 'light'}`);
                    
                    if (savedTheme === 'dark') {
                        console.log(`Applying dark theme after ${tab} tab switch for ${language}`);
                        document.body.classList.add('dark');
                        document.body.classList.remove('gradient-bg');
                        document.body.classList.add('gradient-bg-dark');
                        
                        // Update theme toggle icons
                        const sunIcon = document.getElementById('sun-icon');
                        const moonIcon = document.getElementById('moon-icon');
                        if (sunIcon && moonIcon) {
                            sunIcon.classList.remove('hidden');
                            moonIcon.classList.add('hidden');
                        }
                    } else if (savedTheme === 'light') {
                        console.log(`Applying light theme after ${tab} tab switch for ${language}`);
                        document.body.classList.remove('dark');
                        document.body.classList.remove('gradient-bg-dark');
                        document.body.classList.add('gradient-bg');
                        
                        // Update theme toggle icons
                        const sunIcon = document.getElementById('sun-icon');
                        const moonIcon = document.getElementById('moon-icon');
                        if (sunIcon && moonIcon) {
                            sunIcon.classList.add('hidden');
                            moonIcon.classList.remove('hidden');
                        }
                    }
                }
            }, 50);
        }

        function updateWordCount() {
            const text = document.getElementById('text-input').value;
            const words = text.trim().split(/\s+/).filter(word => word.length > 0).length;
            const chars = text.length;
            
            document.getElementById('word-count').textContent = `Words: ${words}/1,200`;
            document.getElementById('char-count').textContent = `Characters: ${chars}`;
            
            if (words > 1200) {
                document.getElementById('word-count').className = 'text-sm text-red-500';
            } else {
                document.getElementById('word-count').className = 'text-sm text-gray-500';
            }
        }

        function handlePDFUpload(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('pdf-name').textContent = file.name;
                document.getElementById('pdf-size').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                document.getElementById('pdf-info').classList.remove('hidden');
            }
        }

        function clearPDF() {
            document.getElementById('pdf-input').value = '';
            document.getElementById('pdf-info').classList.add('hidden');
        }

        async function processInput() {
            const submitBtn = document.getElementById('submit-btn');
            const loadingModal = document.getElementById('loading-modal');
            const loadingText = document.getElementById('loading-text');
            const progressBar = document.getElementById('progress-bar');

            // Validate input
            if (!validateInput()) {
                return;
            }

            // Show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
            loadingModal.classList.remove('hidden');

            try {
                let result;
                const summaryLength = document.querySelector('input[name="summary-length"]:checked').value;
                
                console.log(`Processing input - Tab: ${currentTab}, Language: {{ language }}, Summary Length: ${summaryLength}`);

                if (currentTab === 'text') {
                    result = await processText(summaryLength);
                } else if (currentTab === 'url') {
                    result = await processURL(summaryLength);
                } else if (currentTab === 'pdf') {
                    result = await processPDF(summaryLength);
                } else if (currentTab === 'youtube') {
                    result = await processYouTube(summaryLength);
                }

                console.log('Processing successful:', result);

                // Update stats
                updateStats(result);

                // Preserve theme before redirect
                const currentTheme = localStorage.getItem('theme');
                const language = '{{ language }}';
                console.log(`Preserving theme ${currentTheme} before redirect to results for ${language}`);
                
                // Ensure theme is properly saved before redirect
                if (currentTheme) {
                    localStorage.setItem('theme', currentTheme);
                    console.log(`Theme ${currentTheme} saved for ${language} before redirect`);
                } else {
                    localStorage.setItem('theme', 'light');
                    console.log(`Default theme 'light' saved for ${language} before redirect`);
                }
                
                // Store summary in sessionStorage to avoid URL length limits
                // URL params have ~2048 char limit, so use storage instead
                const summaryData = {
                    summary: result.summary,
                    title: result.title || 'Summary',
                    language: language,
                    original_length: result.original_length || 0,
                    summary_length: result.summary_length || 0,
                    compression_ratio: result.compression_ratio || 0,
                    processing_time: result.processing_time || 0
                };
                sessionStorage.setItem('lastSummary', JSON.stringify(summaryData));
                
                // Redirect to results with minimal data (just title and language in URL)
                const params = new URLSearchParams({
                    title: result.title || 'Summary',
                    language: language
                });
                window.location.href = `/result?${params.toString()}`;

            } catch (error) {
                console.error('Processing error:', error);
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack,
                    currentTab: currentTab,
                    language: '{{ language }}',
                    summaryLength: document.querySelector('input[name="summary-length"]:checked')?.value
                });
                alert(`Error: ${error.message}`);
            } finally {
                // Hide loading
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>Generate Summary';
                loadingModal.classList.add('hidden');
            }
        }

        function validateInput() {
            if (currentTab === 'text') {
                const text = document.getElementById('text-input').value.trim();
                if (!text) {
                    alert('Please enter some text to summarize.');
                    return false;
                }
                const words = text.split(/\s+/).length;
                if (words > 1200) {
                    alert('Text exceeds 1,200 words. Please shorten your text.');
                    return false;
                }
            } else if (currentTab === 'url') {
                const url = document.getElementById('url-input').value.trim();
                if (!url) {
                    alert('Please enter a URL.');
                    return false;
                }
            } else if (currentTab === 'pdf') {
                const file = document.getElementById('pdf-input').files[0];
                if (!file) {
                    alert('Please select a PDF file.');
                    return false;
                }
            } else if (currentTab === 'youtube') {
                const url = document.getElementById('youtube-input').value.trim();
                if (!url) {
                    alert('Please enter a YouTube URL.');
                    return false;
                }
            }
            return true;
        }

        async function processText(summaryLength) {
            const text = document.getElementById('text-input').value;
            const response = await fetch('/api/summarize/text', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: text,
                    language: '{{ language }}',
                    summary_length: summaryLength
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            if (!result.success) throw new Error(result.detail || 'Unknown error occurred');
            return result;
        }

        async function processURL(summaryLength) {
            const url = document.getElementById('url-input').value;
            const response = await fetch('/api/summarize/url', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    url: url,
                    language: '{{ language }}',
                    summary_length: summaryLength
                })
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            if (!result.success) throw new Error(result.detail || 'Unknown error occurred');
            return result;
        }

        async function processPDF(summaryLength) {
            const file = document.getElementById('pdf-input').files[0];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('language', '{{ language }}');
            formData.append('summary_length', summaryLength);

            const response = await fetch('/api/summarize/pdf', {
                method: 'POST',
                body: formData
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.detail || `HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            if (!result.success) throw new Error(result.detail || 'Unknown error occurred');
            return result;
        }

        async function processYouTube(summaryLength) {
            const url = document.getElementById('youtube-input').value;
            
            // Basic URL validation
            if (!url.includes('youtube.com') && !url.includes('youtu.be')) {
                throw new Error('Please enter a valid YouTube URL (youtube.com or youtu.be)');
            }
            
            console.log(`Processing YouTube with language: {{ language }}, summary_length: ${summaryLength}`);
            
            const response = await fetch('/api/summarize/youtube', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    url: url,
                    language: '{{ language }}',
                    summary_length: summaryLength
                })
            });
            
            console.log(`YouTube API response status: ${response.status}`);
            
            if (!response.ok) {
                const errorData = await response.json();
                const errorMessage = errorData.detail || `HTTP ${response.status}: ${response.statusText}`;
                
                console.error(`YouTube API error: ${errorMessage}`);
                
                // Provide more helpful error messages
                if (errorMessage.includes('captions/transcripts available') || 
                    errorMessage.includes('no transcripts were found') || 
                    errorMessage.includes('could not retrieve a transcript')) {
                    throw new Error('This video doesn\'t have captions/transcripts available. Please try a different video that has captions enabled, or use the Text or URL input options instead.');
                } else if (errorMessage.includes('unavailable or private')) {
                    throw new Error('This video is unavailable or private. Please try a different video.');
                } else if (errorMessage.includes('quota exceeded')) {
                    throw new Error('YouTube API quota exceeded. Please try again later.');
                } else if (errorMessage.includes('Invalid YouTube URL')) {
                    throw new Error('Invalid YouTube URL. Please provide a valid YouTube video URL.');
                } else {
                    throw new Error(errorMessage);
                }
            }
            
            const result = await response.json();
            console.log(`YouTube API result:`, result);
            
            if (!result.success) throw new Error(result.detail || 'Unknown error occurred');
            return result;
        }

        function updateStats(result) {
            processingStats.documents++;
            processingStats.words += result.original_length || 0;
            processingStats.totalTime += result.processing_time || 0;

            document.getElementById('doc-count').textContent = processingStats.documents;
            document.getElementById('word-count-total').textContent = processingStats.words.toLocaleString();
            document.getElementById('avg-time').textContent = 
                processingStats.documents > 0 ? 
                `${(processingStats.totalTime / processingStats.documents).toFixed(1)}s` : '0s';
        }

        function toggleTheme() {
            const body = document.getElementById('body');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            
            if (!body || !sunIcon || !moonIcon) {
                console.error('Theme toggle elements not found');
                return;
            }
            
            // Toggle dark class on body
            body.classList.toggle('dark');
            
            // Toggle background gradient
            if (body.classList.contains('dark')) {
                body.classList.remove('gradient-bg');
                body.classList.add('gradient-bg-dark');
                // Show sun icon (for switching to light mode)
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
                // Store preference
                localStorage.setItem('theme', 'dark');
                console.log('Switched to dark mode');
            } else {
                body.classList.remove('gradient-bg-dark');
                body.classList.add('gradient-bg');
                // Show moon icon (for switching to dark mode)
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                // Store preference
                localStorage.setItem('theme', 'light');
                console.log('Switched to light mode');
            }
        }

        // Initialize theme on page load
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const body = document.getElementById('body');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const language = '{{ language }}';
            
            console.log(`Initializing theme for ${language}, saved theme: ${savedTheme}`);
            
            if (!body || !sunIcon || !moonIcon) {
                console.error('Theme elements not found during initialization');
                return;
            }
            
            // Force remove any existing theme classes first
            body.classList.remove('dark', 'gradient-bg', 'gradient-bg-dark');
            
            if (savedTheme === 'dark') {
                body.classList.add('dark');
                body.classList.remove('gradient-bg');
                body.classList.add('gradient-bg-dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
                console.log(`Initialized dark mode for ${language}`);
            } else {
                body.classList.remove('dark');
                body.classList.remove('gradient-bg-dark');
                body.classList.add('gradient-bg');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
                console.log(`Initialized light mode for ${language}`);
            }
        }
        
        // Theme enforcement function - less aggressive
        function enforceTheme() {
            const savedTheme = localStorage.getItem('theme');
            const isDark = document.body.classList.contains('dark');
            const language = '{{ language }}';
            
            // Only log if there's a mismatch to reduce console spam
            if ((savedTheme === 'dark' && !isDark) || (savedTheme === 'light' && isDark)) {
                console.log(`Theme enforcement check - Language: ${language}, Saved: ${savedTheme}, Current: ${isDark ? 'dark' : 'light'}`);
            }
            
            // Only apply theme if there's a clear mismatch
            if (savedTheme === 'dark' && !isDark) {
                console.log(`Enforcing dark theme for ${language}`);
                document.body.classList.add('dark');
                document.body.classList.remove('gradient-bg');
                document.body.classList.add('gradient-bg-dark');
                
                // Update theme toggle icons
                const sunIcon = document.getElementById('sun-icon');
                const moonIcon = document.getElementById('moon-icon');
                if (sunIcon && moonIcon) {
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                }
            } else if (savedTheme === 'light' && isDark) {
                console.log(`Enforcing light theme for ${language}`);
                document.body.classList.remove('dark');
                document.body.classList.remove('gradient-bg-dark');
                document.body.classList.add('gradient-bg');
                
                // Update theme toggle icons
                const sunIcon = document.getElementById('sun-icon');
                const moonIcon = document.getElementById('moon-icon');
                if (sunIcon && moonIcon) {
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                }
            } else if (!savedTheme) {
                // Default to light theme if no preference is saved
                console.log(`No theme preference found for ${language}, defaulting to light theme`);
                localStorage.setItem('theme', 'light');
                document.body.classList.remove('dark');
                document.body.classList.remove('gradient-bg-dark');
                document.body.classList.add('gradient-bg');
                
                // Update theme toggle icons
                const sunIcon = document.getElementById('sun-icon');
                const moonIcon = document.getElementById('moon-icon');
                if (sunIcon && moonIcon) {
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                }
            }
        }
    </script>
</body>
</html>

